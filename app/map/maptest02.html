<!DOCTYPE html>
<html lang="en">
<head>
  <base href='https://earth-revival-interactive-map.pages.dev/wherewindmeets/' />

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="content-language" content="en" />

  <title>Where Winds Meet Interactive Map</title>

  <link rel="icon" href="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/Simbol/faviconV2.ico?updatedAt=1762922428848" type="image/x-icon" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <script>
    const CSS_VERSION = "5.6.8";
  </script>

  <!-- Custom CSS -->
  <script>
    const cssFiles = [
      'styles.css',
      'marker-image-handler.css',
      'knowladgelist.css',
      'mystic-skill-panel.css',
      'innerway.css',
      'patchnote.css',
      'form.css',
      'layer.css',
      'booklist.css',
      'ui.css',
      'login.css',
      'comment.css',
      'profile-container.css'
    ];
    
    cssFiles.forEach(file => {
      document.write(`<link rel="stylesheet" href="${file}?v=${CSS_VERSION}" />`);
    });
  </script>
</head>  
<body>  

<!-- Filter Panel -->  
<div class="filter-panel" id="filterPanel">  
  <div class="filter-header">  
    <h2 class="filter-title-img">
      <img src="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/alternate.png?updatedAt=1762941265121" alt="Filter Markers" />
    </h2>
  </div>  
    
  <div class="filter-content" id="filterContent"></div>  
    
  <div class="filter-actions">  
    <button class="filter-btn filter-btn-all" id="btnSelectAll">Select All</button>  
    <button class="filter-btn filter-btn-none" id="btnSelectNone">Clear All</button>  
  </div>  
    
  <div class="filter-stats" id="filterStats">  
    Showing <strong>0</strong> markers  
  </div>  
</div>  

<button class="filter-toggle" id="filterToggle">â—€</button>

<div id="map">
  <!-- Notification Icon -->
  <div id="notificationIcon"></div>

  <!-- Notification Popup Container -->
  <div id="notificationBox">
    <h3>Notifications</h3>
    <div id="notificationContent">
      <p>No notifications yet.</p>
    </div>
  </div>
</div>

<!-- âœ… UNIFIED UNDERGROUND CONTAINER -->
<div class="underground-container" id="undergroundContainer">
  <!-- Toggle Button -->
  <button id="undergroundToggle" class="underground-toggle" title="Toggle Underground Floors">
    <img src="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/Simbol/layericon.png" alt="Underground">
  </button>
  
  <!-- Panel -->
  <div id="undergroundPanel" class="underground-panel">
    <!-- Header (hidden by CSS) -->
    <div class="underground-header">
      <h2>ğŸ”ï¸ Floor Selection</h2>
    </div>

    <!-- Content -->
    <div id="undergroundContent" class="underground-content">
      <!-- Floor items will be generated by JavaScript -->
    </div>

    <!-- Stats (hidden by CSS) -->
    <div id="undergroundStats" class="underground-stats">
      <div>
        <span>Active Floor</span>
        <strong id="activeFloorName">Surface</strong>
      </div>
      <div>
        <span>Markers</span>
        <strong id="visibleFloorMarkers">0</strong>
      </div>
    </div>
  </div>
</div>

<!-- Comments Modal -->
<div id="commentsModal" class="comments-modal" style="display: none;">
  <div class="comments-modal-overlay" onclick="closeCommentsModal()"></div>
  <div class="comments-modal-content">
    <div class="comments-modal-header">
      <h3 class="comments-modal-title">ğŸ’¬ Looking for Comments</h3>
      <button class="comments-modal-close" onclick="closeCommentsModal()">&times;</button>
    </div>
    
    <div class="comments-modal-body" id="commentsModalBody">
      <div class="comments-loading">Loading comments...</div>
    </div>
    
    <div class="comments-modal-footer" id="commentsModalFooter">
    </div>
  </div>
</div>

<!-- Patch Notes Popup -->
<div class="patch-overlay" id="patchOverlay">
  <div class="patch-popup">
    <!-- Close Button -->
    <button class="patch-close" onclick="closePatchPopup()">&times;</button>
    
    <!-- Header -->
    <div class="patch-header">
      <img src="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/BangOne.webp" alt="Update" class="patch-image">
      <h2 class="patch-title">ğŸ‰ Map Updated!</h2>
      <p class="patch-subtitle">Latest Changes & Improvements</p>
    </div>
    
    <!-- Content -->
    <div class="patch-content">
      <h3>âœ¨ What's New</h3>
      <ul>
        <li>
          <img src="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/Simbol/knoweverything.webp" alt="Wander Tales" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;">
          <strong> Wander Tales List Available</strong> - New button on map for easy access! All markers now have clear descriptions in popups (more descriptions coming soon for all markers)
        </li>
        <li>
          <img src="https://ik.imagekit.io/k3lv5clxs/wherewindmeet/Simbol/book.webp" alt="Knowledge List" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;">
          <strong> Knowledge List Added</strong> - New map button! Collect notes across all of Jianghua more easily with the organized knowledge list
        </li>
        <li><strong>ğŸ¨ Fixed Button UI Position</strong> - UI is now cleaner and no longer overlapping. Better organized interface!</li>
      </ul>
      
      <h3>ğŸ”® Upcoming Updates</h3>
      <ul>
        <li><strong>ğŸ“ Full Description Coverage</strong> - Descriptions will soon be available for all markers</li>
        <li><strong>âš¡ Server Quota Fix</strong> - Submission limits will be fixed early next month or this week</li>
        <li><strong>ğŸ§˜ Inner Way & Mystic Skill Locations</strong> - Coming very soon!</li>
      </ul>
      
      <h3>ğŸ¯ Previous Updates</h3>
      <ul>
        <li><strong>ğŸ” Login System Improved</strong> - You can now skip profile creation if it fails. No more stuck at login!</li>
        <li><strong>ğŸ“¸ Image Upload Beta</strong> - Upload images directly to markers (experimental feature, report bugs if found)</li>
        <li><strong>ğŸ’¾ Offline Marker Tracking</strong> - Your visited markers now work offline. Progress saved locally!</li>
        <li><strong>ğŸ“± Mobile Optimization</strong> - Best experience now available on mobile web desktop mode</li>
        <li><strong>ğŸ—ºï¸ Enhanced Map Quality</strong> - Zoom in max level without losing map details</li>
        <li>Added <strong>Tiangxing</strong> region with full location coverage</li>
        <li>All mini game locations now discoverable (Fishing, Pitch Pot, Miaodao, Archery, and more)</li>
      </ul>
    </div>
    
    <!-- Footer -->
    <div class="patch-footer">
      <p><strong>Report bugs or suggest features:</strong></p>
      <div class="patch-contact">
        <a href="https://discord.gg/Mt65qFprs" target="_blank" class="patch-link">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
          </svg>
          Discord
        </a>
        <a href="https://www.tiktok.com/@bangonegaming97?_r=1&_t=ZS-91YooxpNS0A" target="_blank" class="patch-link">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74a2.89 2.89 0 0 1 2.31-4.64a2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
          </svg>
          TikTok
        </a>
      </div>
    </div>
    
    <!-- Brand -->
    <div class="patch-brand">
      Made with â¤ï¸ by <strong>Bangone Gaming</strong>
    </div>
</div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>    

<!-- Application Scripts -->    
<script>
  const v = Date.now();
  const files = [
    "memuat-data.js",
    "feedbackmatker.js",
    "descmanager.js",
    "penanda.js",
    "leaderboard.js",
    "marker-image-handler.js",
    "ikon.js",
    "peta.js",
    "booklist.js",
    "knowladgelist.js",
    "mystic-skill-panel.js",
    "innerway.js",
    "profile.js",
    "form.js",
    "layer.js",
    "dev_tools.js",
    "comment.js",
    "patchnote.js",
  ];

  // Load all scripts
  files.forEach(src => {
    const s = document.createElement("script");
    s.src = `${src}?v=${v}`;
    document.body.appendChild(s);
  });

  // Load main.js with defer
  const main = document.createElement("script");
  main.src = `main.js?v=${v}`;
  main.defer = true;
  document.body.appendChild(main);
</script>
  
</body>  
</html>
